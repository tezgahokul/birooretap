<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <title>Biroor Akƒ±llƒ± Tahta Paneli</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { margin: 0; padding: 0; font-family: "Segoe UI", Arial, sans-serif; background: linear-gradient(135deg, #00c4cc, #7d2ae8); height: 100vh; display: flex; flex-direction: column; color: #fff; overflow: hidden; }
        #setupOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); backdrop-filter: blur(15px); z-index: 1000; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .setup-box { background: rgba(255,255,255,0.1); padding: 40px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); width: 400px; }
        .setup-box select, .setup-box input { padding: 15px; font-size: 18px; border-radius: 10px; border: none; margin: 10px 0; width: 100%; box-sizing: border-box; }
        .top { display: flex; height: 100vh; padding: 20px; gap: 20px; }
        .clock-panel { width: 28%; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(8px); border-radius: 20px; padding: 30px; display: flex; flex-direction: column; justify-content: center; text-align: center; box-shadow: 0 0 30px rgba(0,0,0,0.3); }
        #clock { font-size: 80px; font-weight: bold; }
        #date { font-size: 28px; opacity: 0.8; margin-bottom: 20px;}
        #classDisplay { font-size: 22px; color: #00fff5; font-weight: bold; cursor: pointer; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 10px; line-height: 1.5; }
        .lessons-panel { flex: 1; background: rgba(255, 255, 255, 0.12); backdrop-filter: blur(8px); border-radius: 20px; padding: 30px; display: flex; flex-direction: column; box-shadow: 0 0 30px rgba(0,0,0,0.3); }
        .lesson-box { background: rgba(255, 255, 255, 0.15); padding: 15px; border-radius: 12px; margin-bottom: 8px; font-size: 22px; border-left: 6px solid #00fff5; }
        .active-lesson { background: rgba(0,255,245,0.4) !important; border-left-color: #fff !important; transform: scale(1.02); }
        .right-panel { width: 30%; display: flex; flex-direction: column; gap: 15px; }
        .widget { background: rgba(255, 255, 255, 0.12); backdrop-filter: blur(8px); border-radius: 20px; padding: 15px; box-shadow: 0 0 30px rgba(0,0,0,0.3); }
        button { padding: 10px; border: none; border-radius: 8px; cursor: pointer; background: #00c4cc; color: #fff; font-weight: bold; transition: 0.3s; }
        button:hover { background: #008c91; }
        input { padding: 10px; border-radius: 8px; border: none; width: 90%; margin-bottom: 10px; }
        .homework-item { background: rgba(255,255,255,0.1); margin: 5px 0; padding: 8px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        .delete-btn { background: #ff4b2b !important; padding: 5px 10px; font-size: 14px; }
    </style>
</head>
<body>

<div id="setupOverlay" style="display: none;">
    <div class="setup-box">
        <h1>Biroor Panel Kurulumu</h1>
        <p>Sƒ±nƒ±fƒ± se√ßin:</p>
        <select id="classSelector">
            <option value="5A">5-A</option><option value="5B">5-B</option><option value="5C">5-C</option><option value="5D">5-D</option>
            <option value="6A">6-A</option><option value="6B">6-B</option><option value="6C">6-C</option>
            <option value="7A">7-A</option><option value="7B">7-B</option><option value="7C">7-C</option><option value="7D">7-D</option>
            <option value="8A">8-A</option><option value="8B">8-B</option><option value="8C">8-C</option>
        </select>
        <p>Cihaz ƒ∞smi Girin:</p>
        <input type="text" id="deviceNameInput" placeholder="Cihaz Adƒ±">
        <br><br>
        <button onclick="saveClassChoice()" style="padding: 15px 40px; font-size: 18px;">Sistemi Ba≈ülat</button>
    </div>
</div>

<div class="top">
    <div class="clock-panel">
        <div id="clock">00:00</div>
        <div id="date">...</div>
        <div id="classDisplay" onclick="resetSetup()">-- / --</div>
        <div id="currentLesson" style="margin-top:20px; font-size:22px; color:#ffeb3b;">Y√ºkleniyor...</div>
    </div>

    <div class="lessons-panel">
        <h2 id="dayTitle">Ders Programƒ±</h2>
        <div id="lessons"></div>
    </div>

    <div class="right-panel">
        <button id="fullscreenBtn">Tam Ekran</button>
        <button onclick="window.location.href='indir.html'" style=" height: 45px; background: #ff9800; white-space: nowrap; font-size: 14px; padding: 0 5px; font-weight: bold;">
        üöÄ Kur
    </button>
        <div class="widget">
            <h3>√ñdev Tahtasƒ±</h3>
            <div id="homeworkBox" style="max-height: 150px; overflow-y: auto; margin-bottom:10px;"></div>
            <input type="text" id="hwTitle" placeholder="√ñdev Ba≈ülƒ±ƒüƒ±">
            <input type="text" id="hwDesc" placeholder="√ñdev A√ßƒ±klamasƒ±">
            <button id="addHomework" style="width:100%">Ekle</button>
        </div>
        <div class="widget" id="weatherWidget">
            <h3>Cide Hava Durumu</h3>
            <div id="weatherBox" style="text-align:center;">...</div>
        </div>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, getDocs, setDoc, addDoc, deleteDoc, doc, query, where, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyB47g_CyDXPM_eCeHyVfLg9PB24boD5xKY",
    authDomain: "birooretap.firebaseapp.com",
    projectId: "birooretap",
    storageBucket: "birooretap.appspot.com",
    messagingSenderId: "28899321149",
    appId: "1:28899321149:web:420b38058db31b06439154"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const lessonIcons = {
    "MAT": "üìê", "FEN": "üß™", "T√úRK6": "üìö", "T√úRK5": "üìö", "ƒ∞NG3": "üåç", "ƒ∞NG4": "üåç",
    "SOSYL": "üó∫Ô∏è", "Dƒ∞N": "üåô", "BEDEN": "‚öΩ", "M√úZƒ∞K": "üéµ", "G√ñRSEL": "üé®",
    "Bƒ∞Lƒ∞≈û": "üíª", "ROBOTK": "ü§ñ", "TDB": "üìñ", "REHBR": "ü§ù", "ƒ∞NKLP": "üáπüá∑",
    "TEK T.": "üõ†Ô∏è", "Sƒ∞NG": "üó£Ô∏è", "OYUN1": "üéÆ", "OYUN2": "üéÆ", "AHLAK": "üíé", "√áEVƒ∞D": "üåø", "G√ñRG√ú": "ü§ù", "PROJE": "üí°"
};

const schoolData = {
    "5A": {
        "Pazartesi": ["MAT","MAT","TDB","TDB","SOSYL","Bƒ∞Lƒ∞≈û","Bƒ∞Lƒ∞≈û"],
        "Salƒ±": ["ƒ∞NG3","ƒ∞NG3","MAT","MAT","OYUN1","T√úRK6","T√úRK6"],
        "√áar≈üamba": ["G√ñRSEL","FEN","FEN","BEDEN","BEDEN","T√úRK6","T√úRK6"],
        "Per≈üembe": ["Dƒ∞N","Dƒ∞N","Sƒ∞NG","Sƒ∞NG","SOSYL","SOSYL","REHBR"],
        "Cuma": ["ƒ∞NG3","M√úZƒ∞K","MAT","FEN","FEN","T√úRK6","T√úRK6"]
    },
    "5B": {
        "Pazartesi": ["Sƒ∞NG","Sƒ∞NG","ƒ∞NG3","MAT","MAT","T√úRK6","T√úRK6"],
        "Salƒ±": ["FEN","FEN","T√úRK6","T√úRK6","MAT","TDB","TDB"],
        "√áar≈üamba": ["Bƒ∞Lƒ∞≈û","Bƒ∞Lƒ∞≈û","MAT","MAT","SOSYL","BEDEN","BEDEN"],
        "Per≈üembe": ["FEN","FEN","SOSYL","SOSYL","REHBR","Dƒ∞N","Dƒ∞N"],
        "Cuma": ["G√ñRSEL","ƒ∞NG3","ƒ∞NG3","T√úRK6","T√úRK6","M√úZƒ∞K","OYUN1"]
    },
    "5C": {
        "Pazartesi": ["T√úRK6","T√úRK6","MAT","ƒ∞NG3","SOSYL","SOSYL","G√ñRSEL"],
        "Salƒ±": ["T√úRK6","T√úRK6","ƒ∞NG3","ƒ∞NG3","FEN","FEN","SOSYL"],
        "√áar≈üamba": ["MAT","MAT","Dƒ∞N","Dƒ∞N","OYUN1","FEN","FEN"],
        "Per≈üembe": ["M√úZƒ∞K","TDB","TDB","T√úRK6","T√úRK6","Bƒ∞Lƒ∞≈û","Bƒ∞Lƒ∞≈û"],
        "Cuma": ["MAT","MAT","BEDEN","BEDEN","Sƒ∞NG","Sƒ∞NG","REHBR"]
    },
    "5D": {
        "Pazartesi": ["Dƒ∞N","Dƒ∞N","REHBR","T√úRK6","T√úRK6","ƒ∞NG3","SOSYL"],
        "Salƒ±": ["MAT","MAT","Bƒ∞Lƒ∞≈û","Bƒ∞Lƒ∞≈û","SOSYL","SOSYL","OYUN1"],
        "√áar≈üamba": ["BEDEN","BEDEN","ƒ∞NG3","ƒ∞NG3","MAT","FEN","FEN"],
        "Per≈üembe": ["Sƒ∞NG","Sƒ∞NG","M√úZƒ∞K","TDB","TDB","T√úRK6","T√úRK6"],
        "Cuma": ["T√úRK6","T√úRK6","G√ñRSEL","MAT","MAT","FEN","FEN"]
    },
    "6A": {
        "Pazartesi": ["ROBOTK","ROBOTK","T√úRK6","T√úRK6","G√ñRSEL","Dƒ∞N","Dƒ∞N"],
        "Salƒ±": ["BEDEN","BEDEN","MAT","FEN","FEN","Bƒ∞Lƒ∞≈û","Bƒ∞Lƒ∞≈û"],
        "√áar≈üamba": ["ƒ∞NG3","ƒ∞NG3","MAT","MAT","REHBR","T√úRK6","T√úRK6"],
        "Per≈üembe": ["SOSYL","SOSYL","T√úRK6","T√úRK6","FEN","FEN","OYUN1"],
        "Cuma": ["M√úZƒ∞K","MAT","MAT","ƒ∞NG3","SOSYL","TDB","TDB"]
    },
    "6B": {
        "Pazartesi": ["MAT","MAT","ƒ∞NG3","FEN","FEN","T√úRK6","T√úRK6"],
        "Salƒ±": ["TDB","TDB","ƒ∞NG3","ƒ∞NG3","SOSYL","T√úRK6","T√úRK6"],
        "√áar≈üamba": ["MAT","MAT","SOSYL","SOSYL","Dƒ∞N","Dƒ∞N","OYUN1"],
        "Per≈üembe": ["T√úRK6","T√úRK6","ROBOTK","ROBOTK","BEDEN","BEDEN","REHBR"],
        "Cuma": ["MAT","Bƒ∞Lƒ∞≈û","Bƒ∞Lƒ∞≈û","FEN","FEN","G√ñRSEL","M√úZƒ∞K"]
    },
    "6C": {
        "Pazartesi": ["T√úRK6","T√úRK6","TDB","TDB","M√úZƒ∞K","MAT","MAT"],
        "Salƒ±": ["FEN","FEN","SOSYL","T√úRK6","T√úRK6","BEDEN","BEDEN"],
        "√áar≈üamba": ["FEN","FEN","Dƒ∞N","Dƒ∞N","ROBOTK","ROBOTK","MAT"],
        "Per≈üembe": ["Bƒ∞Lƒ∞≈û","Bƒ∞Lƒ∞≈û","ƒ∞NG3","ƒ∞NG3","T√úRK6","T√úRK6","REHBR"],
        "Cuma": ["OYUN1","G√ñRSEL","SOSYL","SOSYL","ƒ∞NG3","MAT","MAT"]
    },
    "7A": {
        "Pazartesi": ["ƒ∞NG4","ƒ∞NG4","T√úRK5","T√úRK5","MAT","MAT","M√úZƒ∞K"],
        "Salƒ±": ["T√úRK5","G√ñRSEL","SOSYL","MAT","MAT","TEK T.","TEK T."],
        "√áar≈üamba": ["Dƒ∞N","Dƒ∞N","FEN","FEN","REHBR","ƒ∞NG4","ƒ∞NG4"],
        "Per≈üembe": ["FEN","FEN","SOSYL","SOSYL","PROJE","AHLAK","AHLAK"],
        "Cuma": ["BEDEN","BEDEN","OYUN2","OYUN2","T√úRK5","T√úRK5","MAT"]
    },
    "7B": {
        "Pazartesi": ["T√úRK5","T√úRK5","MAT","MAT","AHLAK","AHLAK","PROJE"],
        "Salƒ±": ["MAT","MAT","Dƒ∞N","Dƒ∞N","REHBR","ƒ∞NG4","ƒ∞NG4"],
        "√áar≈üamba": ["ƒ∞NG4","ƒ∞NG4","G√ñRSEL","SOSYL","SOSYL","TEK T.","TEK T."],
        "Per≈üembe": ["T√úRK5","T√úRK5","FEN","FEN","SOSYL","OYUN2","OYUN2"],
        "Cuma": ["FEN","FEN","M√úZƒ∞K","MAT","BEDEN","BEDEN","T√úRK5"]
    },
    "7C": {
        "Pazartesi": ["SOSYL","FEN","FEN","M√úZƒ∞K","T√úRK5","BEDEN","BEDEN"],
        "Salƒ±": ["G√ñRSEL","T√úRK5","T√úRK5","Dƒ∞N","Dƒ∞N","ƒ∞NG4","ƒ∞NG4"],
        "√áar≈üamba": ["SOSYL","SOSYL","ƒ∞NG4","ƒ∞NG4","MAT","MAT","REHBR"],
        "Per≈üembe": ["OYUN2","OYUN2","MAT","T√úRK5","T√úRK5","AHLAK","AHLAK"],
        "Cuma": ["FEN","FEN","TEK T.","TEK T.","MAT","MAT","PROJE"]
    },
    "7D": {
        "Pazartesi": ["G√ñRSEL","M√úZƒ∞K","SOSYL","SOSYL","TEK T.","TEK T.","MAT"],
        "Salƒ±": ["ƒ∞NG4","ƒ∞NG4","PROJE","T√úRK5","T√úRK5","MAT","MAT"],
        "√áar≈üamba": ["OYUN2","OYUN2","SOSYL","FEN","FEN","MAT","MAT"],
        "Per≈üembe": ["BEDEN","BEDEN","T√úRK5","Dƒ∞N","Dƒ∞N","ƒ∞NG4","ƒ∞NG4"],
        "Cuma": ["T√úRK5","T√úRK5","REHBR","AHLAK","AHLAK","FEN","FEN"]
    },
    "8A": {
        "Pazartesi": ["Dƒ∞N","Dƒ∞N","G√ñRSEL","ƒ∞NG4","ƒ∞NG4","FEN","FEN"],
        "Salƒ±": ["ƒ∞NKLP","ƒ∞NKLP","FEN","FEN","T√úRK5","G√ñRG√ú","G√ñRG√ú"],
        "√áar≈üamba": ["√áEVƒ∞D","√áEVƒ∞D","BEDEN","BEDEN","T√úRK5","T√úRK5","MAT"],
        "Per≈üembe": ["MAT","MAT","T√úRK5","T√úRK5","REHBR","AHLAK","AHLAK"],
        "Cuma": ["MAT","MAT","ƒ∞NG4","ƒ∞NG4","M√úZƒ∞K","TEK T.","TEK T."]
    },
    "8B": {
        "Pazartesi": ["FEN","FEN","M√úZƒ∞K","G√ñRG√ú","G√ñRG√ú","ƒ∞NG4","ƒ∞NG4"],
        "Salƒ±": ["Dƒ∞N","Dƒ∞N","T√úRK5","√áEVƒ∞D","√áEVƒ∞D","FEN","FEN"],
        "√áar≈üamba": ["MAT","MAT","ƒ∞NG4","ƒ∞NG4","G√ñRSEL","AHLAK","AHLAK"],
        "Per≈üembe": ["ƒ∞NKLP","ƒ∞NKLP","BEDEN","BEDEN","MAT","T√úRK5","T√úRK5"],
        "Cuma": ["TEK T.","TEK T.","MAT","MAT","REHBR","T√úRK5","T√úRK5"]
    },
    "8C": {
        "Pazartesi": ["M√úZƒ∞K","√áEVƒ∞D","√áEVƒ∞D","FEN","FEN","BEDEN","BEDEN"],
        "Salƒ±": ["T√úRK5","T√úRK5","ƒ∞NG4","ƒ∞NG4","G√ñRSEL","MAT","MAT"],
        "√áar≈üamba": ["Dƒ∞N","Dƒ∞N","MAT","MAT","ƒ∞NG4","ƒ∞NG4","T√úRK5"],
        "Per≈üembe": ["G√ñRG√ú","G√ñRG√ú","FEN","FEN","REHBR","TEK T.","TEK T."],
        "Cuma": ["ƒ∞NKLP","ƒ∞NKLP","T√úRK5","T√úRK5","AHLAK","AHLAK","MAT"]
    }
};

const lessonHours = [
    {s: "08:30", e: "09:10"}, {s: "09:20", e: "10:00"}, {s: "10:10", e: "10:50"},
    {s: "11:00", e: "11:40"}, {s: "11:50", e: "12:30"}, {s: "13:40", e: "14:20"}, {s: "14:30", e: "15:10"}
];

window.saveClassChoice = () => {
    const selClass = document.getElementById("classSelector").value;
    const selName = document.getElementById("deviceNameInput").value || "Adsƒ±z Cihaz";
    localStorage.setItem("myClass", selClass);
    localStorage.setItem("deviceName", selName);
    location.reload();
};

window.resetSetup = () => { if(confirm("ayarlar sƒ±fƒ±rlansƒ±n mƒ±?")) { localStorage.clear(); location.reload(); } };

const currentClass = localStorage.getItem("myClass") || "";
const deviceName = localStorage.getItem("deviceName") || "";

if(!currentClass || !deviceName) {
    document.getElementById("setupOverlay").style.display = "flex";
} else {
    document.getElementById("classDisplay").innerText = currentClass + " / " + deviceName;
    startApp();
}

function startApp() {
    const hwCol = collection(db, "homeworks");

    const presenceDoc = doc(db, "presence", currentClass + "_" + deviceName.replace(/\s+/g, '_'));
    const cNum = parseInt(currentClass.charAt(0));
    const cSec = currentClass.charAt(1);

    async function updatePresence() {
        try {
            await setDoc(presenceDoc, {
                className: currentClass,
                deviceName: deviceName,
                lastSeen: serverTimestamp(),
                status: "online"
            }, { merge: true });
        } catch (e) { console.error("Presence Error:", e); }
    }

    async function loadHW() {
        const q = query(hwCol, where("classNumber", "==", cNum), where("classSection", "==", cSec));
        const snap = await getDocs(q);
        const box = document.getElementById("homeworkBox");
        box.innerHTML = "";
        snap.forEach(d => {
            box.innerHTML += `
                <div class="homework-item">
                    <span><b>${d.data().title}</b>: ${d.data().desc}</span>
                    <button class="delete-btn" onclick="window.delHW('${d.id}', '${d.data().title}')">Sƒ∞L</button>
                </div>`;
        });
    }

    document.getElementById("addHomework").onclick = async () => {
        const t = document.getElementById("hwTitle").value;
        const d = document.getElementById("hwDesc").value;
        if(t) {
            await addDoc(hwCol, { title: t, desc: d, classNumber: cNum, classSection: cSec });
            document.getElementById("hwTitle").value = ""; document.getElementById("hwDesc").value = "";
            loadHW();
        }
    };
    
    window.delHW = async (id, title) => { 
        if(confirm(`"${title}" √∂devini silmek istediƒüinize emin misiniz?`)) {
            await deleteDoc(doc(db, "homeworks", id)); 
            loadHW(); 
        }
    };

    function tick() {
        const now = new Date();
        const day = now.toLocaleDateString("tr-TR", {weekday: "long"});
        const timeStr = now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0');
        
        document.getElementById("clock").innerText = timeStr;
        document.getElementById("date").innerText = now.toLocaleDateString("tr-TR", {day:'numeric', month:'long'});
        
        const prog = schoolData[currentClass] ? schoolData[currentClass][day] : null;
        const list = document.getElementById("lessons");
        list.innerHTML = "";
        
        if (!prog) {
            document.getElementById("currentLesson").innerText = "ƒ∞yi Tatiller! ";
            list.innerHTML = "<div style='text-align:center; margin-top:50px; font-size:24px;'>Bug√ºn ders programƒ± bulunmuyor.</div>";
        } else {
            let found = false;
            prog.forEach((ders, i) => {
                const isCur = (timeStr >= lessonHours[i].s && timeStr <= lessonHours[i].e);
                const icon = lessonIcons[ders] || "üìù";
                list.innerHTML += `<div class="lesson-box ${isCur?'active-lesson':''}"> ${icon} ${i+1}. Ders: ${ders} <span style="float:right; font-size:14px; opacity:0.8;">${lessonHours[i].s} - ${lessonHours[i].e}</span></div>`;
                if(isCur) { 
                    const [hEnd, mEnd] = lessonHours[i].e.split(':');
                    const endTime = new Date();
                    endTime.setHours(parseInt(hEnd), parseInt(mEnd), 0);
                    const diff = Math.ceil((endTime - now) / 60000);
                    document.getElementById("currentLesson").innerHTML = `Ders: ${ders} <br> <span style="font-size:18px; color:#fff;">(Biti≈üe ${diff} dk kaldƒ±)</span>`; 
                    found = true; 
                }
            });
            if(!found) document.getElementById("currentLesson").innerText = "≈ûu an: Teneff√ºs ‚òï";
        }
        
 
        updatePresence(); 
    }

    loadHW();
    setInterval(tick, 1000); tick();
    getWeather();
}

async function getWeather() {
    try {
        const r = await fetch("https://api.open-meteo.com/v1/forecast?latitude=41.89&longitude=32.99&current_weather=true");
        const d = await r.json();
        const w = d.current_weather;
        const code = w.weathercode;           
        let icon="‚òÄÔ∏è";
        if(code>=1 && code<=3) icon="‚õÖ";
        if(code>=45) icon="üå´Ô∏è";
        if(code>=51) icon="üå¶Ô∏è";
        if(code>=61) icon="üåßÔ∏è";
        if(code>=71) icon="‚ùÑÔ∏è";
        if(code>=95) icon="‚õàÔ∏è";
        document.getElementById("weatherBox").innerHTML = `<h1 style="margin:0;">${icon} ${Math.round(w.temperature)}¬∞C</h1><small>Cide, Kastamonu</small>`;
    } catch(e) { }
}

const fsBtn = document.getElementById("fullscreenBtn");
fsBtn.onclick = () => {
    if (!document.fullscreenElement) document.documentElement.requestFullscreen();
    else document.exitFullscreen();
};
</script>
<div style="display: flex; gap: 10px; margin-top: 5px;">

</body>
</html>